---
title: "Data manipulation with R"
subtitle: " `dplyr`- Manipulating data, `tidyr`- Cleaning data"
author: "Suhas. P. K"
date: "`r Sys.Date()`"
output:
  rmdformats::downcute:
    self_contained: true
    default_style: "dark"
    downcute_theme: "default"
    toc : 6
---


```{r setup, include=FALSE}
## Global options
knitr::opts_chunk$set(cache = TRUE)
```

```{r libraries, message=FALSE, warning=FALSE, include=FALSE}
if (!require(dplyr)){
  install.packages("dplyr")
  library(dplyr)
}

if (!require(tidyr)){
  install.packages("tidyr")
  library(tidyr)
}

if (!require(nycflights13)){
  install.packages("nycflights13")
  library(nycflights13)
}
```

```{r flight dataset info, message=FALSE, warning=FALSE}
?flights
```


```{r}
head(flights)

# View(flights)

str(flights)
```

Links

- [Introduction to `dplyr`](https://cran.r-project.org/web/packages/dplyr/vignettes/dplyr.html)

- [Data tidying with `tidyr` - Cheatsheet](https://github.com/rstudio/cheatsheets/blob/master/tidyr.pdf)

- [Data wrangling with `dplyr` and `tidyr` - Cheat sheet](https://www.rstudio.com/wp-content/uploads/2015/02/data-wrangling-cheatsheet.pdf)

Single variable verbs

`dplry` aims to provide a function for each basic verb of data manipulation. These verbs can be organised into three categories based on the component of the dataset that they work with:
- Rows: 
  - `filter()` chooses rows based on column values.
  - `slice()` chooses rows based on location.
  - `arrange()` changes the order of the rows.

- Columns:
  - `select()` changes whether or not a column is included.
  - `rename()` changes the name of columns.
  - `mutate()` changes the values of columns and creates new columns.
  - `relocate()` changes the order of the columns.
  
- Groups of rows:
  - `summarise()` collapses a group into a single row.
  
- `transmute()`  creates a new data frame containing only the specified computations.

- `summarise()` or `summarize()`  creates a new data frame. It returns one row for each combination of grouping variables; if there are no grouping variables, the output will have a single row summarising all observations in the input. It will contain one column for each grouping variable and one column for each of the summary statistics that you have specified.

I need to know filter data, in November, day 3 and carrier is AA. 

```{r filtering data1, message=FALSE, warning=FALSE}

head(filter(flights, month == 11, day==3, carrier == 'AA'))
```
An equivalent approach of using `filter()`.

```{r filtering data2, message=FALSE, warning=FALSE}

head(flights[flights$month == 11 & flights$day==3 & flights$carrier == 'AA',])
```

```{r arrange data1}
head(arrange(flights, year,month,day,air_time))
```

```{r arrange data2}
head(arrange(flights, year,month,day,arr_time))
```
notice how the given fields are arranged in ascending order.

```{r arrange data3}
head(arrange(flights, desc(year),month,day,arr_time))
```
Here, I have used `desc()` to arrange specified field in descending order.

```{r selecting data1}
head(select(flights, carrier))
```

```{r selecting data2}
head(select(flights, carrier, arr_time))
```

```{r selecting data3}
head(select(flights, carrier, arr_time, month))
```

```{r distinct data}
distinct(select(flights, carrier))
```

```{r mutate data}
head(
  mutate(
    flights, new_col = arr_delay - dep_delay
  )
)
```


```{r summarise data1}
summarise(flights, avg_air_time = mean(air_time, na.rm=TRUE))
```

```{r summarise data2}
summarise(flights, total_time = sum(air_time, na.rm=TRUE))
```

```{r sample_n data1}
sample_n(flights, 10)
```

```{r sample_frac data2}
sample_frac(flights,0.1)
```


```{r mtcars data1}
df <- mtcars

result <- arrange(sample_n(
  filter(
    df, mpg>20
  ), size = 5
), desc(mpg))

print(result)
```

```{r mtcars data2}
a <- filter(df, mpg>20)
b <- sample_n(a, size = 5)
result <- arrange(b, desc(mpg))
print(result)
```


```{r mtcars data3}
result <- df %>% filter(mpg>20) %>% sample_n(size = 5) %>% arrange(desc(mpg))
print(result)
```



































































